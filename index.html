
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Read Me Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="docs/components/" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Table of Contents</li>
        
        
    
        <li class="chapter active" data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Read Me
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="docs/components/">
            
                <a href="docs/components/">
            
                    
                    Components
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="docs/components/IDGeneration.html">
            
                <a href="docs/components/IDGeneration.html">
            
                    
                    ID Generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="docs/components/ShardingFunctions.html">
            
                <a href="docs/components/ShardingFunctions.html">
            
                    
                    Sharding Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="docs/components/ReadStrategies.html">
            
                <a href="docs/components/ReadStrategies.html">
            
                    
                    Read Strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="docs/components/Router.html">
            
                <a href="docs/components/Router.html">
            
                    
                    The Router
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="docs/components/OtherComponents.html">
            
                <a href="docs/components/OtherComponents.html">
            
                    
                    Other Components
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="docs/installation/">
            
                <a href="docs/installation/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="docs/installation/HowToShard.html">
            
                <a href="docs/installation/HowToShard.html">
            
                    
                    Choosing How To Shard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="docs/installation/Settings.html">
            
                <a href="docs/installation/Settings.html">
            
                    
                    Settings
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="docs/usage/">
            
                <a href="docs/usage/">
            
                    
                    Usage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="docs/usage/AnotherDB.html">
            
                <a href="docs/usage/AnotherDB.html">
            
                    
                    Store Models on Another DB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="docs/usage/ShardingAModel.html">
            
                <a href="docs/usage/ShardingAModel.html">
            
                    
                    Sharding A Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="docs/usage/Migrations.html">
            
                <a href="docs/usage/Migrations.html">
            
                    
                    Model Migration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="docs/usage/DataMigrations.html">
            
                <a href="docs/usage/DataMigrations.html">
            
                    
                    Data Migrations
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="docs/advanced/">
            
                <a href="docs/advanced/">
            
                    
                    Advanced Topics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="docs/advanced/ReplicationLag.html">
            
                <a href="docs/advanced/ReplicationLag.html">
            
                    
                    Replication Lag
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="docs/advanced/Rebalancing.html">
            
                <a href="docs/advanced/Rebalancing.html">
            
                    
                    Shard Rebalancing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="CHANGES.md">
            
                <span>
            
                    
                    Change Log
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Read Me</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="django-sharding"><a href="https://github.com/JBKahn/django-sharding" target="_blank">Django Sharding</a></h1>
<p>Django Sharding is a library and part-framework for sharding Django applications.</p>
<p>It helps you to scale your applications by sharding your data across multiple databases in a consistent way.</p>
<p><a href="https://travis-ci.org/JBKahn/django-sharding" target="_blank"><img src="https://travis-ci.org/JBKahn/django-sharding.svg?branch=master" alt="Build Status"></a>
<a href="https://badge.fury.io/py/django-sharding" target="_blank"><img src="https://badge.fury.io/py/django-sharding.svg" alt="PyPI version"></a>
<a href="https://crate.io/packages/django-sharding/" target="_blank"><img src="https://img.shields.io/pypi/dm/django-sharding.svg" alt="PyPi downloads"></a>
<a href="https://coveralls.io/github/JBKahn/django-sharding?branch=master" target="_blank"><img src="https://coveralls.io/repos/JBKahn/django-sharding/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a></p>
<h3 id="what-is-sharding">What is Sharding?</h3>
<p>Sharding is a way of horizontally partitioning your data by storing different rows of the same table in multiple tables across multiple databases. This helps to increase the number of connections to a given resource as well as improves read performance of your application.</p>
<h3 id="read-the-documentation">Read The Documentation</h3>
<p>For information about how to setup sharding in your application, <a href="http://josephkahn.io/django-sharding/" target="_blank">read the documentation</a>.</p>
<h3 id="developer-experience">Developer Experience</h3>
<p>I wrote this library after working on this problem for <a href="https://www.waveapps.com" target="_blank">Wave</a> and not being able to find a library that suited our needs. What we were looking for was something that was powerful, extensible and customizable. This library was created for just that purpose and includes at least one implimentation of each part of the pipeline with room to replace any individual components.</p>
<h3 id="influences">Influences</h3>
<p>The package was influenced by my experiences at Wave as well as the help and code of my co-workers.</p>
<h3 id="installation">Installation</h3>
<p>Check out the <a href="http://josephkahn.io/django-sharding/docs/installation/Settings.html" target="_blank">installation section</a> of the docs for basic package setup.</p>
<h3 id="basis-setup--usage">Basis Setup &amp; Usage</h3>
<h4 id="sharding-by-user">Sharding by User</h4>
<p>Select a model to shard by and open up the models.py file. Here we&apos;ll use the user model:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> AbstractUser

<span class="hljs-keyword">from</span> django_sharding_library.models <span class="hljs-keyword">import</span> ShardedByMixin


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(AbstractUser, ShardedByMixin)</span>:</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<p>Add that custom User to your settings file using the string class path:</p>
<pre><code class="lang-python">AUTH_USER_MODEL = <span class="hljs-string">&apos;&lt;app_with_user_model&gt;.User&apos;</span>
</code></pre>
<h4 id="create-your-first-sharded-model">Create Your First Sharded Model</h4>
<p>Define your new model, eg:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-keyword">from</span> django_sharding_library.decorators <span class="hljs-keyword">import</span> model_config
<span class="hljs-keyword">from</span> django_sharding_library.fields <span class="hljs-keyword">import</span> TableShardedIDField
<span class="hljs-keyword">from</span> django_sharding_library.models <span class="hljs-keyword">import</span> TableStrategyModel


<span class="hljs-meta">@model_config(database=&apos;default&apos;)</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShardedCarIDs</span><span class="hljs-params">(TableStrategyModel)</span>:</span>
    <span class="hljs-keyword">pass</span>


<span class="hljs-meta">@model_config(sharded=True)</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span><span class="hljs-params">(models.Model)</span>:</span>
    id = TableShardedIDField(primary_key=<span class="hljs-keyword">True</span>, source_table=ShardeCarIDs)
    ignition_type = models.CharField(max_length=<span class="hljs-number">120</span>)
    company = models.ForeignKey(<span class="hljs-string">&apos;companies.Company&apos;</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_shard</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.company.user.shard
</code></pre>
<h3 id="running-migrations">Running migrations</h3>
<p>Run them as normal, for example:</p>
<pre><code>./manage.py makemigrations &lt;app_name&gt;

# To let django run the migrations in all the right places.
./manage.py migrate &lt;app&gt;

# To specify the database to run it on
./manage.py migrate &lt;app&gt; --database=&lt;database_alias&gt;
</code></pre><h3 id="acccessing-sharded-data">Acccessing sharded data</h3>
<pre><code class="lang-python"><span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Update this with methods.</span>
shard = User.shard
Car.objects.using(shard).get(id=<span class="hljs-number">123</span>)
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="docs/components/" class="navigation navigation-next navigation-unique" aria-label="Next page: Components">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Read Me","level":"1.1","depth":1,"next":{"title":"Components","level":"1.2","depth":1,"path":"docs/components/README.md","ref":"docs/components/README.md","articles":[{"title":"ID Generation","level":"1.2.1","depth":2,"path":"docs/components/IDGeneration.md","ref":"docs/components/IDGeneration.md","articles":[]},{"title":"Sharding Functions","level":"1.2.2","depth":2,"path":"docs/components/ShardingFunctions.md","ref":"docs/components/ShardingFunctions.md","articles":[]},{"title":"Read Strategies","level":"1.2.3","depth":2,"path":"docs/components/ReadStrategies.md","ref":"docs/components/ReadStrategies.md","articles":[]},{"title":"The Router","level":"1.2.4","depth":2,"path":"docs/components/Router.md","ref":"docs/components/Router.md","articles":[]},{"title":"Other Components","level":"1.2.5","depth":2,"path":"docs/components/OtherComponents.md","ref":"docs/components/OtherComponents.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["search"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search":{},"highlight":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"links":{},"gitbook":"3.x.x"},"file":{"path":"README.md","mtime":"2016-10-07T21:56:53.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-10-07T22:10:52.928Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

